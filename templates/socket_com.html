<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=yes">

    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        socket.on('message', function(data) {
            console.log(data);
        });
    </script> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>Upload new File</title>


</head>

<body>
    <!-- <h1>Upload new File</h1>
    <form method=post enctype=multipart/form-data>
        <input type=file name=file>
        <input type=submit value=Upload>
    </form> -->

    <form id="upload-file" method="post" enctype="multipart/form-data">
        <label for="file">Select a file</label>
        <input name="file" type="file">
        <button id="upload-file-btn" type="button">Upload</button>
    </form>
    <div class="container" id="my_progress_bar">
        <h2>File uploaded & training is in progress</h2>
        <div class="progress">
            <div class="progress-bar" role="progressbar" id="pbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%">
                0%
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('#my_progress_bar').hide();
            var socket = io.connect('http://' + document.domain + ':' + location.port);

            socket.on('connect', function() {
                    console.log("socket connected")
                        //     socket.emit('my event', {
                        //         data: 'User Connected'
                        //     })
                })
                // socket.on('my response', function(msg) {
                //     console.log(msg)
                // })

            socket.on('message', function(data) {
                console.log("progress : ", data);
                $('#my_progress_bar').show();

                document.getElementById("pbar").style.width = data + "%";
                document.getElementById("pbar").innerHTML = data + "%";

            });
            $('#upload-file-btn').click(function() {

                var form_data = new FormData($('#upload-file')[0]);
                $.ajax({
                    type: 'POST',
                    url: '/upload',
                    data: form_data,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success: function(data) {
                        console.log('Success!');
                    },
                });
            });
        });
        // $(function() {

        // });
    </script>


</body>

</html>